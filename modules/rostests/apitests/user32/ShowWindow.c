/*
 * PROJECT:     ReactOS API tests
 * LICENSE:     LGPL-2.1+ (https://spdx.org/licenses/LGPL-2.1+)
 * PURPOSE:     Tests for ShowWindow
 * COPYRIGHT:   Copyright 2021 Katayama Hirofumi MZ <katayama.hirofumi.mz@gmail.com>
 */

#include "precomp.h"

typedef struct TEST_ENTRY
{
    INT lineno;
    BOOL ret;
    INT nCmdShow;
    DWORD style0;
    DWORD style1;
} TEST_ENTRY;

static const CHAR s_name[] = "ShowWindow test window";

static void DoTestEntry(const TEST_ENTRY *pEntry)
{
    HWND hwnd;
    DWORD style;
    BOOL ret;

    hwnd = CreateWindowA(s_name, s_name, pEntry->style0,
        CW_USEDEFAULT, CW_USEDEFAULT, 100, 100,
        NULL, NULL, GetModuleHandleA(NULL), NULL);
    ok(!!hwnd, "Line %d: CreateWindowA failed\n", pEntry->lineno);

    ret = !!ShowWindow(hwnd, pEntry->nCmdShow);
    ok(ret == pEntry->ret, "Line %d: ShowWindow returns %d\n", pEntry->lineno, ret);

    style = (LONG)GetWindowLongPtrA(hwnd, GWL_STYLE);
    ok(style == pEntry->style1, "Line %d: style was 0x%lX\n", pEntry->lineno, style);

    DestroyWindow(hwnd);
}

#define STYLE_0 WS_OVERLAPPEDWINDOW
#define STYLE_1 (WS_OVERLAPPEDWINDOW | WS_MAXIMIZE)
#define STYLE_2 (WS_OVERLAPPEDWINDOW | WS_MINIMIZE)
#define STYLE_3 (WS_OVERLAPPEDWINDOW | WS_VISIBLE)
#define STYLE_4 (WS_OVERLAPPEDWINDOW | WS_VISIBLE | WS_MAXIMIZE)
#define STYLE_5 (WS_OVERLAPPEDWINDOW | WS_VISIBLE | WS_MINIMIZE)

static const TEST_ENTRY s_entries[] =
{
    // STYLE_0
    { __LINE__, FALSE, -1, STYLE_0, STYLE_0 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_HIDE, STYLE_0, STYLE_0 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_MAXIMIZE, STYLE_0, STYLE_0 | WS_VISIBLE | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_MINIMIZE, STYLE_0, STYLE_0 | WS_VISIBLE | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_RESTORE, STYLE_0, STYLE_0 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOW, STYLE_0, STYLE_0 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWDEFAULT, STYLE_0, STYLE_0 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMAXIMIZED, STYLE_0, STYLE_0 | WS_VISIBLE | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMINIMIZED, STYLE_0, STYLE_0 | WS_VISIBLE | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMINNOACTIVE, STYLE_0, STYLE_0 | WS_VISIBLE | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNA, STYLE_0, STYLE_0 | WS_VISIBLE| WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNOACTIVATE, STYLE_0, STYLE_0 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNORMAL, STYLE_0, STYLE_0 | WS_VISIBLE | WS_CLIPSIBLINGS },
    // STYLE_1
    { __LINE__, FALSE, -1, STYLE_1, STYLE_1 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_HIDE, STYLE_1, STYLE_1 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_MAXIMIZE, STYLE_1, STYLE_1 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_MINIMIZE, STYLE_1, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_RESTORE, STYLE_1, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOW, STYLE_1, STYLE_1 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWDEFAULT, STYLE_1, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMAXIMIZED, STYLE_1, STYLE_1 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMINIMIZED, STYLE_1, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMINNOACTIVE, STYLE_1, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNA, STYLE_1, STYLE_1 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNOACTIVATE, STYLE_1, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNORMAL, STYLE_1, STYLE_3 | WS_CLIPSIBLINGS },
    // STYLE_2
    { __LINE__, FALSE, -1, STYLE_2, STYLE_2 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_HIDE, STYLE_2, STYLE_2 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_MAXIMIZE, STYLE_2, STYLE_3 | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_MINIMIZE, STYLE_2, STYLE_2 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_RESTORE, STYLE_2, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOW, STYLE_2, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWDEFAULT, STYLE_2, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMAXIMIZED, STYLE_2, STYLE_3 | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMINIMIZED, STYLE_2, STYLE_2 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWMINNOACTIVE, STYLE_2, STYLE_2 | WS_VISIBLE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNA, STYLE_2, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNOACTIVATE, STYLE_2, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, FALSE, SW_SHOWNORMAL, STYLE_2, STYLE_3 | WS_CLIPSIBLINGS },
    // STYLE_3
    { __LINE__, FALSE, -1, STYLE_3, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_HIDE, STYLE_3, WS_OVERLAPPEDWINDOW | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_MAXIMIZE, STYLE_3, STYLE_3 | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_MINIMIZE, STYLE_3, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_RESTORE, STYLE_3, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOW, STYLE_3, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWDEFAULT, STYLE_3, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMAXIMIZED, STYLE_3, STYLE_3 | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMINIMIZED, STYLE_3, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMINNOACTIVE, STYLE_3, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNA, STYLE_3, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNOACTIVATE, STYLE_3, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNORMAL, STYLE_3, STYLE_3 | WS_CLIPSIBLINGS },
    // STYLE_4
    { __LINE__, FALSE, -1, STYLE_4, STYLE_4 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_HIDE, STYLE_4, WS_OVERLAPPEDWINDOW | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_MAXIMIZE, STYLE_4, STYLE_4 | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_MINIMIZE, STYLE_4, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_RESTORE, STYLE_4, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOW, STYLE_4, STYLE_4 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWDEFAULT, STYLE_4, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMAXIMIZED, STYLE_4, STYLE_4 | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMINIMIZED, STYLE_4, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMINNOACTIVE, STYLE_4, STYLE_3 | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNA, STYLE_4, STYLE_4 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNOACTIVATE, STYLE_4, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNORMAL, STYLE_4, STYLE_3 | WS_CLIPSIBLINGS },
    // STYLE_5
    { __LINE__, FALSE, -1, STYLE_5, STYLE_5 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_HIDE, STYLE_5, WS_OVERLAPPEDWINDOW | WS_MINIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_MAXIMIZE, STYLE_5, STYLE_3 | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_MINIMIZE, STYLE_5, STYLE_5 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_RESTORE, STYLE_5, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOW, STYLE_5, STYLE_5 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWDEFAULT, STYLE_5, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMAXIMIZED, STYLE_5, STYLE_3 | WS_MAXIMIZE | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMINIMIZED, STYLE_5, STYLE_5 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWMINNOACTIVE, STYLE_5, STYLE_5 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNA, STYLE_5, STYLE_5 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNOACTIVATE, STYLE_5, STYLE_3 | WS_CLIPSIBLINGS },
    { __LINE__, TRUE, SW_SHOWNORMAL, STYLE_5, STYLE_3 | WS_CLIPSIBLINGS },
};

static LRESULT CALLBACK
WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam)
{
    switch (uMsg)
    {
        case WM_CREATE:
            return 0;
        case WM_DESTROY:
            PostQuitMessage(0);
            break;
        default:
            return DefWindowProcA(hwnd, uMsg, wParam, lParam);
    }
    return 0;
}

START_TEST(ShowWindow)
{
    WNDCLASSA wc;
    UINT iTest;

    ZeroMemory(&wc, sizeof(wc));
    wc.lpfnWndProc = WindowProc;
    wc.hInstance = GetModuleHandleA(NULL);
    wc.hbrBackground = (HBRUSH)(COLOR_3DFACE + 1);
    wc.lpszClassName = s_name;
    ok_int(1, !!RegisterClassA(&wc));

    for (iTest = 0; iTest < _countof(s_entries); ++iTest)
    {
        DoTestEntry(&s_entries[iTest]);
    }
}
